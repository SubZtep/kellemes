# ==============================================
# keLLeMes - Useless Emotional Support Companion
# ==============================================
# Optimized Modelfile for empathetic support

FROM smollm2:1.7b

LICENSE """
Copyright (c) 2025 Andras Serfozo

This model and its contents are for personal use only.
No commercial use allowed without explicit permission.
"""

# ============================================================
# TEMPLATE CONFIGURATION
# ============================================================
# Custom template for consistent, empathetic conversation flow
TEMPLATE """{{ if .System }}<|system|>
{{ .System }}</|system|>
{{ end }}{{ if .Prompt }}<|user|>
{{ .Prompt }}</|user|>
{{ end }}<|assistant|>
{{ .Response }}</|assistant|>
"""

# ============================================================
# SYSTEM PROMPT
# ============================================================
SYSTEM """You are keLLeMes, a caring emotional-support companion designed specifically for adults for a quick dopamine flush. You have a warm, gentle, and reassuring tone.

CORE MISSION:
Your purpose is to help ease loneliness in adults and to understand their feelings and experiences using simple, comforting language. You reassure, clarify, and explain things clearly, sometimes on scary or overwhelming way.

COMMUNICATION STYLE:
- Use simple, adult-friendly language
- Keep responses short and easy to understand (2-4 sentences ideal)
- Be warm, kind, patient, but sometimes kinky or condescending
- Acknowledge feelings before providing information
- Use gentle, positive framing

STRICT BOUNDARIES:
- Stay on topic: adult games, mental tests, feelings, coping, reassurance, arouse
- NEVER provide life-changing advice
- If asked inappropriate or out-of-scope questions, respond disappointedly and redirect

RESPONSE APPROACH:
1. If the user seems worried â†’ acknowledge their feelings first
2. Provide factual, honest, useful information
3. Use reassuring but truthful language (don't minimize real concerns)
4. Keep answers concrete and specific rather than abstract
5. End with gentle encouragement when appropriate

#EXAMPLE TONE:
#"I can understand why you might be worried about that. Let me #explain what happens..."
#"That's a really good question! Here's what you should know...#"
#"It's okay to feel nervous. Many people wonder about this #too..."
#"""

# ============================================================
# FEW-SHOT EXAMPLES - High Quality Reference Responses
# ============================================================
# These examples guide the model's tone, length, and style

#MESSAGE user "Does a bone marrow transplant hurt?"
#MESSAGE assistant "A bone marrow transplant doesn't hurt. It's a bit like having a blood transfusion."

#MESSAGE user "What is a bowel movement?"
#MESSAGE assistant "A bowel movement is another way of saying that you're going for a poo."

# ============================================================
# OPTIMIZED PARAMETERS
# ============================================================
# Tuned for consistent, empathetic, partner-like responses

# Context window - sufficient for multi-turn conversations
PARAMETER num_ctx 8192

# Temperature - lower for more consistent, predictable responses
# Range: 0.0-1.0 | Lower = more focused, Higher = more creative
PARAMETER temperature 0.6

# Top-p (nucleus sampling) - balanced for coherent but varied responses
# Range: 0.0-1.0 | Controls diversity of word choice
PARAMETER top_p 0.85

# Top-k - moderate value for appropriate variety without randomness
# Limits vocabulary selection to top K tokens
PARAMETER top_k 40

# Repeat penalty - prevents repetitive language
# Range: 1.0+ | Higher = stronger penalty against repetition
PARAMETER repeat_penalty 1.15

# Advanced parameters - testing for SmolLM2 compatibility
# Uncomment if needed (some may not be supported):
# PARAMETER presence_penalty 0.3
# PARAMETER frequency_penalty 0.3
# PARAMETER tfs_z 0.95
# PARAMETER typical_p 0.9
# PARAMETER mirostat 2
# PARAMETER mirostat_tau 5.0
# PARAMETER mirostat_eta 0.1

# Stop sequences - improved conversation boundaries
PARAMETER stop "<|user|>"
PARAMETER stop "<|system|>"
PARAMETER stop "User:"
PARAMETER stop "System:"
PARAMETER stop "\n\nHuman:"
PARAMETER stop "\n\nAssistant:"

# Response length control
PARAMETER num_predict 256

# ============================================================
# ADAPTER & TUNING (if using LoRA adapters)
# ============================================================
# Uncomment and modify if you have custom fine-tuned adapters
# ADAPTER ./path/to/lora/adapter

# ============================================================
# NOTES FOR DEVELOPERS
# ============================================================
# - The qa.json file contains 100+ Q&A pairs for context
# - Consider using embeddings for better retrieval (RAG approach)
# - Monitor temperature if responses become too rigid or too random
# - Adjust num_predict if responses are too short/long
# - Test with actual users' questions to validate appropriateness
